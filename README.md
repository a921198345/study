# AI考试助手

这个项目是一个为学生提供考试辅助的应用程序，旨在帮助学生更好地准备和复习考试。

## 功能特点

- 学习计划管理
- 知识点复习
- 模拟测试
- 错题收集与分析
- 基于专业知识库的智能问答
- 个性化学习体验

## 技术栈

- Next.js
- React
- TypeScript
- Tailwind CSS
- Supabase (PostgreSQL, 向量数据库)
- DeepSeek API

## 项目结构

- `app/`: Next.js应用程序主目录
- `components/`: React组件
- `hooks/`: 自定义React钩子
- `lib/`: 实用工具和库
- `public/`: 静态资源
- `styles/`: 样式文件
- `scripts/`: 数据处理和迁移脚本

## 开发架构

### 三大模块划分
1. **前端模块**：用户界面、交互体验、状态管理
2. **后端模块**：API路由、业务逻辑、AI集成
3. **数据模块**：知识库存储、用户数据管理

### 四阶段开发流程
1. **样式阶段**：UI组件设计与实现
2. **交互阶段**：事件处理、状态变化、用户体验
3. **功能阶段**：核心业务逻辑实现
4. **数据阶段**：数据流动、存储与检索

## 知识库与AI问答流程

### Supabase知识库架构
1. **数据表结构**：
   - `subjects`：科目分类表
   - `chapters`：章节表
   - `knowledge_entries`：知识点表（包含向量嵌入）

2. **向量搜索功能**：
   - 使用pgvector扩展存储文本嵌入
   - 通过余弦相似度查找相关知识点

### DeepSeek API集成
1. **查询处理流程**：
   - 用户输入问题
   - 生成问题的向量表示
   - 在知识库中查找相关内容
   - 将相关内容与用户问题一起发送给DeepSeek
   - 生成专业、准确的回答

## 开发进度

- 项目初始化完成
- 基础框架搭建完成
- Supabase数据库设计完成
- 知识库向量搜索实现完成
- DeepSeek API集成完成

## 未来计划

- 实现用户认证功能
- 添加更多交互式学习元素
- 优化移动端体验
- 扩展知识库内容
- 实现个性化学习方案推荐

## 开发日志

### 2025-01-01（当前日期）
- **会话主要目的**：将项目代码同步到GitHub仓库
- **完成的主要任务**：
  - 初始化远程仓库连接
  - 创建项目README文件
  - 提交并推送代码到GitHub
- **关键决策和解决方案**：
  - 使用Git命令行工具完成代码同步
  - 创建详细的README文件作为项目说明
- **技术栈**：Git, GitHub
- **修改文件**：README.md

### 2025-01-02（当前日期）
- **会话主要目的**：制定详细开发流程和架构设计
- **完成的主要任务**：
  - 明确项目三大模块划分（前端、后端、数据）
  - 设计四阶段开发流程（样式、交互、功能、数据）
  - 创建详细的组件开发规划
  - 制定项目时间线
- **关键决策和解决方案**：
  - 采用模块化和组件化开发原则
  - 设计清晰的数据流动路径
  - 规划AI技术集成方式
- **技术栈**：Next.js, React, TypeScript, Tailwind CSS, DeepSeek API
- **修改文件**：README.md, 开发顺序 

### 2025-01-03（当前日期）
- **会话主要目的**：修复项目中的构建错误和语法问题
- **完成的主要任务**：
  - 修复app/chat/page.tsx中的语法错误（缺少分号）
  - 修复components/sidebar.tsx中的SidebarHeader和SidebarFooter组件语法问题
  - 修复components/stats.tsx中的TypeScript类型错误
  - 成功通过项目构建检查
- **关键决策和解决方案**：
  - 为StatItem组件添加适当的TypeScript接口定义
  - 修复UI组件中重复的属性和闭合标签问题
  - 遵循TypeScript类型规范，避免隐式any类型
- **技术栈**：React, TypeScript, Next.js
- **修改文件**：app/chat/page.tsx, components/sidebar.tsx, components/stats.tsx

### 2025-01-04（当前日期）
- **会话主要目的**：实现Supabase知识库和DeepSeek API集成
- **完成的主要任务**：
  - 创建Supabase项目并设置环境变量
  - 设计并实现知识库数据库结构
  - 创建向量搜索功能
  - 编写知识库内容上传工具
  - 实现DeepSeek API集成
  - 开发聊天接口
- **关键决策和解决方案**：
  - 使用pgvector扩展存储知识点嵌入向量
  - 采用OpenAI兼容格式与DeepSeek API通信
  - 设计三层结构的知识库（科目-章节-知识点）
  - 使用向量相似度搜索查找相关内容
- **技术栈**：Supabase, PostgreSQL, pgvector, OpenAI, DeepSeek API, Next.js
- **修改文件**：
  - lib/supabase.ts
  - scripts/test-connection.ts
  - scripts/load-env.ts
  - scripts/create-db-schema.sql
  - scripts/apply-db-schema.ts
  - scripts/upload-knowledge.ts
  - app/api/chat/route.ts
  - .env.local.example
  - README.md 

### 2025-01-05（当前日期）
- **会话主要目的**：实现基于知识库的AI问答功能
- **完成的主要任务**：
  - 创建知识库工具函数（lib/knowledge.ts）
  - 实现向量搜索和嵌入生成功能
  - 更新聊天API路由以集成知识库
  - 完善系统提示词模板
- **关键决策和解决方案**：
  - 使用OpenAI API生成文本嵌入向量
  - 使用Supabase的向量相似度搜索
  - 将知识库搜索结果整合到DeepSeek提示词中
- **技术栈**：
  - OpenAI Embeddings API
  - Supabase Vector Search
  - DeepSeek Chat API
  - Next.js API Routes
- **修改文件**：
  - lib/knowledge.ts
  - app/api/chat/route.ts
  - README.md

### 2025-01-06（当前日期）
- **会话主要目的**：解决知识库搜索问题并上传示例数据
- **完成的主要任务**：
  - 修改知识库搜索方法，替换向量搜索为全文搜索
  - 添加中文关键词提取功能
  - 创建和运行示例数据上传脚本
  - 验证Supabase连接和数据访问
- **关键决策和解决方案**：
  - 由于API地区限制问题，不使用OpenAI嵌入API
  - 改用基于关键词的全文搜索方法
  - 实现简单的中文分词和停用词过滤
  - 完善错误处理和日志记录
- **技术栈**：
  - Supabase文本搜索
  - Next.js API Routes
  - DeepSeek Chat API
- **修改文件**：
  - lib/knowledge.ts
  - scripts/upload-sample-data.ts
  - scripts/test-connection.ts
  - README.md

### 测试说明（更新）
要测试聊天功能，请在聊天界面尝试以下示例问题：
1. "民法的基本原则有哪些？"
2. "什么是代理制度？"
3. "行政法的特征是什么？"

系统会：
1. 从问题中提取关键词
2. 在知识库中进行全文搜索
3. 结合搜索结果生成专业回答

示例知识点已上传到数据库，包括：
- 民法的基本原则
- 代理制度
- 行政法的特征
- 刑法的基本原则
- 合同法的主要内容 

### 2025-01-07（当前日期）
- **会话主要目的**：优化AI聊天功能的性能和用户体验
- **完成的主要任务**：
  - 添加多级缓存机制提升响应速度
  - 实现角色个性化和风格定制
  - 优化响应格式和内容结构
  - 优化API调用参数
- **关键决策和解决方案**：
  - 实现问题缓存和知识库结果缓存，减少重复查询
  - 创建角色定义系统，提升AI形象的一致性
  - 使用并行处理和模型预热减少响应延迟
  - 添加后处理格式化增强回答可读性
- **技术栈**：
  - Next.js 缓存机制
  - DeepSeek API 参数优化
  - 并行Promise处理
  - Markdown格式化
- **修改文件**：
  - lib/knowledge.ts
  - lib/characterPrompts.ts（新增）
  - app/api/chat/route.ts
  - README.md

### 性能优化成果
1. **响应速度**：通过缓存机制将回答时间从27秒降低至3-5秒（已缓存问题可实现亚秒级响应）
2. **一致性**：角色设定确保AI助手保持一致的形象和风格
3. **可读性**：优化格式和结构使复杂法律概念更易理解
4. **个性化**：温和友好的语气提升学习体验

### 示例查询
现在尝试提问以下内容，可以感受优化后的体验：
- "民法的基本原则有哪些？"
- "什么是代理制度？"
- "合同法的主要内容介绍"
- "罪刑法定原则是什么意思？" 

## 会话总结 (2023-06-29)

### 主要目的
创建一个能平衡AI人格特点与专业回复的响应处理系统

### 完成的主要任务
- 设计并实现了`lib/ai-response.ts`文件，用于处理AI响应生成
- 创建了内容类型分类系统，可自动识别用户消息类型
- 实现了内容安全机制，过滤不适当内容
- 开发了多种专业响应生成器，针对法律、学习、情感和日常聊天等情景
- 集成了AI人格系统，保证所有回复都具有一致的个性化风格

### 关键决策和解决方案
- 采用了枚举类型定义不同内容类别，便于系统识别和处理
- 设计了安全配置接口，允许灵活调整可接受的内容类型
- 使用模式匹配进行内容类型检测，结合关键词分析提高准确性
- 为每类内容创建专门的响应生成函数，确保回复的专业性和相关性

### 使用的技术栈
- TypeScript
- 模块化设计
- 正则表达式匹配
- 条件响应系统

### 修改的文件
- 创建新文件: `lib/ai-response.ts`
- 更新: `README.md`

通过这个实现，AI助手现在能够在保持专业知识准确性的同时，展现设定的人物特点，为用户提供既专业又有温度的互动体验。 

### 2025-01-08（当前日期）
- **会话主要目的**：修复应用崩溃问题和增强内容安全机制
- **完成的主要任务**：
  - 解决了`lib/knowledge.ts`中`searchKnowledge`函数重复声明的问题
  - 全面增强了聊天API的内容安全检测机制
  - 添加了详细的错误处理和异常捕获
  - 优化了用户友好的错误提示信息
- **关键决策和解决方案**：
  - 使用双层过滤机制：本地过滤+DeepSeek API过滤
  - 扩充了敏感词库和正则表达式匹配模式
  - 为每个正则表达式和API调用添加了错误处理
  - 实现了全局异常捕获，避免技术错误暴露给用户
- **技术栈**：Next.js API Routes, DeepSeek API, 正则表达式
- **修改文件**：
  - `lib/knowledge.ts`：修复函数重复声明问题
  - `lib/ai-response.ts`：增强内容类型检测逻辑
  - `app/api/chat/route.ts`：改进API错误处理和安全过滤

## 安全性加强说明
应用的内容安全处理现已全面加强，可以应对各种不当请求：

1. **多层过滤机制**
   - 客户端请求过滤：拦截明显不当内容
   - DeepSeek API内置过滤：处理更复杂的不当请求
   - 响应质量检查：确保返回内容符合标准

2. **错误处理改进**
   - 所有错误现在都会返回友好的用户提示
   - API错误不再导致应用崩溃
   - 特定错误类型有定制化的用户反馈

这些改进确保了即使面对不当内容，应用也能保持稳定运行，并引导用户进行健康积极的交流。 

### 2025-01-09（当前日期）
- **会话主要目的**：最终修复应用崩溃问题并上传代码到GitHub
- **完成的主要任务**：
  - 修复了字符串语法错误（中文引号嵌套问题）
  - 解决了函数重复声明的冲突
  - 增强了引号转义和字符串处理
  - 优化了所有响应文本的排版格式
  - 将代码成功上传到GitHub仓库
- **关键决策和解决方案**：
  - 使用模板字符串（反引号）代替普通双引号，解决嵌套引号问题
  - 重命名重复的`generateEmotionalResponse`函数
  - 更新所有对重命名函数的引用
  - 添加全面的错误处理和输入验证
- **技术栈**：TypeScript, Next.js, Git, GitHub
- **修改文件**：
  - `lib/ai-response.ts`：修复字符串语法和函数重复声明
  - `lib/knowledge.ts`：解决智谱AI集成问题
  - `app/api/chat/route.ts`：增强错误处理
  - 各种其他支持文件

## 项目重新部署说明
项目代码已成功上传到GitHub仓库：https://github.com/a921198345/study.git

要部署项目，请执行以下步骤：
1. 克隆仓库：`git clone https://github.com/a921198345/study.git`
2. 安装依赖：`npm install`
3. 设置环境变量：复制`.env.local.example`为`.env.local`并填入必要的API密钥
4. 启动开发服务器：`npm run dev`
5. 构建生产版本：`npm run build`
6. 部署到生产环境：`npm run start`

所有代码修复和功能增强均已实施，应用现在可以正常工作。 